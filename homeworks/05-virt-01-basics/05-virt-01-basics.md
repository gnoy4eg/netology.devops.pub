
# Домашнее задание к занятию "5.1. Введение в виртуализацию. Типы и функции гипервизоров. Обзор рынка вендоров и областей применения."

## Задача 1

Опишите кратко, как вы поняли: в чем основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.  

Ответ:  
Основное отличие - метод развертывания виртуальной среды на серверах.
* Полная - ставится на голое железо
* Паравиртуализация - устанавливается в уже установленную ОС на голом железе
* На основе ОС - контейниризация, используется ядро запущенной ОС  
На мой взгляд, самый безопасный и правильный метод - аппаратная виртуализация. Обычно, подобные системы стартуют с флешки, не зависят от какой-либо базовой ОС, просты в развертывании, но не в настройке :)

## Задача 2

Выберите один из вариантов использования организации физических серверов, в зависимости от условий использования.

Организация серверов:
- физические сервера,
- паравиртуализация,
- виртуализация уровня ОС.

Условия использования:
- Высоконагруженная база данных, чувствительная к отказу.
- Различные web-приложения.
- Windows системы для использования бухгалтерским отделом.
- Системы, выполняющие высокопроизводительные расчеты на GPU.

Опишите, почему вы выбрали к каждому целевому использованию такую организацию.  

Ответ:  
Мой выбор такой:
| Организация серверов | Условия использования | Пояснения |
| ---------------------|-----------------------|------------|
| физические сервера | Высоконагруженная база данных, чувствительная к отказу; Системы, выполняющие высокопроизводительные расчеты на GPU | Для базы важен отклик железа, устанавливаем ее на живое железо, молимся что бы не упало; <br> Майним так же на живом железе т.к. GPU будет занят 99.9% времени, от виртуализации не вижу смысла |
| паравиртуализация | Windows системы для использования бухгалтерским отделом | Не критичные сервисы, развернуть где-нибудь в VirtualBox'е, отделив бухгалтерские программы друг от друга |
| виртуализация уровня ОС | Различные web-приложения | Могут часто изменяться приложения, нужна ci\cd + контейнеризация |

P.S. Я бы не использовал чистые физические сервера (кроме майнинга на GPU), развернул бы аппаратную виртуализацию. Таким образом повысил отказоустойчивость высоконагруженной базы данных (снапшоты, бекапирование)


## Задача 3

Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.

Сценарии:

1. 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.
2. Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.
3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.
4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.  

Ответ:  
1. Если вопрос цены не стоит, то: vmware esxi + vmware vcenter + veeam. Если нет особых требований, то важна универсальность. Сегодня инфраструктура может быть такая, а завтра уже другая. vmware позволит быть на острие, частые обновления, большой список поддерживаемого железа. Связка esxi+vsphere позволит объединить все железные сервера в один кластер. veeam все это дело будет бекапировать. Дополнительно добавить СХД - будет сказка \:)
2. KVM. Бесплатно. Очень быстро, главное не упереться в I/O. Может win и linux. Дополнительно установить ProxMox - будет красиво и достаточно просто. Есть потенциал для большого роста. 20-30 ВМ далеко не предел.
3. Xen PV. С win чуть более совместимо, чем KVM, а так KVM :)
4. Vagrant + VirtualBox. Бесплатно. Удобно. Можно подготовить однотипные конфиг-файлы для разных дистрибутивов, разворачивать тестовую среду при необходимости, удалять по окончании тестирования.


## Задача 4

Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, то создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.  

Ответ:  
Возможные проблемы и недостатки гетерогенной среды виртуализации:
* Более высокий порог входа для новых специалистов
* По невнимательности настройки могут различаться (сеть, файрволы и т.п.)
* Зачастую нет возможности перенести ВМ из одной среды в другую простым способом
* Бекапирование со всем вытекащими последствиями. Что? чем? куда и как? На все эти вопросы необходимо ответить при настройке бекапирования данных и ВМ.

Полагаю, что для минимизации проблем вызванных использованием гетерогенной среды стоит использовать заранее выбранное одно решение от одного производителя.  
<br>
Да, я бы создал гетерогенную среду, но без фанатизма. Четко разделив, например, прод и тест. Прод должен быть на "железобетонном" гипервизоре (KVM, vmware), быть стабильным, без неожиданностей. Для тестовых сред я "пробую" разные решения из представленных. Это не позволяет "заскучать", позволяет "пощупать" разные решения разных производителей и иметь о них какое-то представление.

---

## ДОРАБОТКА ДЗ

Задание 1

В чём разница при работе с ядром гостевой ОС для полной и паравиртуализации;  
Чем аппаратная и паравиртуализации отличаются от полной виртуализации?  
Ответ:  
* При паравиртуализации гипервизор модифицирует ядро гостевой ОС для разделения доступа к железу сервера. При полной виртуализации модификации ядра гостевой ОС не происходит, гипервизор служит связующим звеном между гостевой ОС и железом сервера.
* Аппаратная виртуализация от полной ничем не отличается - это определение одной и той же технологии виртуализации (слова синонимы в данном контексте). Паравиртуализация от полной (аппаратной) отличается тем, что для ее гипервизора необходима ОС на железе сервера для доступа к аппаратным ресурсам хоста, тогда как гипервизоры при полной (аппаратной) виртуализации сами являются ОС.  

Задание 4
Для тестовых сред я “пробую” разные решения из представленных…
Это, конечно, интересно, но в подавляющем большинстве случаев тестовое окружение - это “прод” для тестировщиков, поэтому эксперименты с инфраструктурой будут оказывать влияние как и на сами тесты, так и на прод, если средства виртуализации не будут совпадать.  
Ответ:  
Согласен :)